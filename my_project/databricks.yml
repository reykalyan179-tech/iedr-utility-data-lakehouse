bundle:
  name: iedr-utility-data-lakehouse

include:
  - resources/*.yml

variables:
  catalog:
    description: Unity Catalog name
  target_schema:
    description: Target schema for DLT pipeline (per environment)
  dlt_development:
    description: Enable DLT development mode

targets:
  dev:
    mode: development
    default: true
    workspace:
      host: https://dbc-e775cabb-a867.cloud.databricks.com
    variables:
      catalog: workspace
      target_schema: dev
      dlt_development: true

  qa:
    mode: development
    workspace:
      host: https://dbc-e775cabb-a867.cloud.databricks.com
    variables:
      catalog: workspace
      target_schema: qa
      dlt_development: true

  prod:
    mode: production
    workspace:
      host: https://dbc-e775cabb-a867.cloud.databricks.com
      root_path: /Workspace/Users/mravindra0911@gmail.com/.bundle/${bundle.name}/${bundle.target}
    variables:
      catalog: workspace
      target_schema: prod
      dlt_development: false

resources:
  jobs:
    iedr_pipeline:
      name: iedr-${bundle.target}-pipeline
      tasks:
        - task_key: bronze_ingest
          notebook_task:
            notebook_path: notebooks/bronze_ingest.ipynb
            base_parameters:
              env: ${var.target_schema}

        - task_key: silver_transform
          depends_on:
            - task_key: bronze_ingest
          notebook_task:
            notebook_path: notebooks/silver_transformation.ipynb
            base_parameters:
              env: ${var.target_schema}
